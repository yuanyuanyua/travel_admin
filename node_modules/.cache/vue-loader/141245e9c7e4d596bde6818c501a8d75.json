{"remainingRequest":"D:\\QQ下载文件\\BT\\travel_manage\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\QQ下载文件\\BT\\travel_manage\\src\\components\\page\\ConstantList.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\QQ下载文件\\BT\\travel_manage\\src\\components\\page\\ConstantList.vue","mtime":1581329197732},{"path":"D:\\QQ下载文件\\BT\\travel_manage\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\QQ下载文件\\BT\\travel_manage\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\QQ下载文件\\BT\\travel_manage\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\QQ下载文件\\BT\\travel_manage\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport api from '../../utils/api';\n\nexport default {\n    name: 'ConstantList',\n    data() {\n        return {\n            query: {\n                address: '',\n                name: '',\n                pageIndex: 1,\n                pageSize: 10\n            },\n            tableData: [],\n            pageTotal: 10,\n            isLoading: false,\n            categoryList: [],\n            categoryIdMap: {},\n            handleTitle: '',\n            editVisible: false,\n            form: {},\n            ajaxData: {\n                id: 0,\n                category_id: 0,\n                name: '',\n                des: ''\n            },\n            searchType: '',\n            search_key_word: '',\n            showType: 'normalData'\n        };\n    },\n    methods: {\n        getTableData() {\n            this.isLoading = true;\n            var that = this;\n            api.getCategoryCons({\n                pageNum: that.query.pageIndex,\n                pageSize: that.query.pageSize\n            }).then(res0 => {\n                console.log(res0);\n                api.getCategorys().then(res1 => {\n                    console.log(res1);\n                    this.categoryList = res1.data;\n                    res1.data.forEach(e => {\n                        this.categoryIdMap[e.name] = e.id;\n                    });\n                    res0.data.categorycons.forEach(c => {\n                        c['category_name'] = this.categoryList[c.category_id - 1].name;\n                    });\n                    this.tableData = res0.data.categorycons;\n                    this.isLoading = false;\n                    this.pageTotal = res0.data.total;\n                }).catch(err => {\n                    console.log(err);\n                });\n            }).catch(err => {\n                console.log(err);\n            });\n        },\n        handleAdd() {\n            this.handleTitle = '添加常量';\n            this.editVisible = true;\n            this.form = {};\n        },\n        handleDeleteAllSelection() {\n\n        },\n        handleSelection(e) {\n            console.log(e);\n            this.$confirm(`确定要删除${e.length}行吗`, '提示', {\n                type: 'warning'\n            }).catch(err => {\n                console.log(err);\n            });\n        },\n        handlePageChange(val, e) {\n            this.$set(this.query, 'pageIndex', val);\n            if (this.showType === 'normalData') {\n                this.getTableData();\n            } else {\n                this.getSearchResult(e, val);\n            }\n\n        },\n        handleEdit(index, row) {\n            this.handleTitle = '编辑常量';\n            this.form = row;\n            this.ajaxData.id = row.id;\n            this.ajaxData.category_id = this.form.category_id;\n            this.ajaxData.name = this.form.name;\n            this.ajaxData.des = this.form.des;\n            this.editVisible = true;\n        },\n        handleDelete(index, row) {\n            this.$confirm('确定要删除吗', '提示', {\n                type: 'warning'\n            }).then(() => {\n                this.isLoading = true;\n                this.api.deleteCategoryCons({\n                    id: row.id\n                }).then(res => {\n                    this.isLoading = false;\n                    this.$message.success(`删除成功`);\n                    this.getTableData();\n                });\n            });\n        },\n        handleDialogClose(e) {\n            // this.getTableData();\n        },\n        getCategory_id(e) {\n            this.ajaxData.category_id = e;\n            this.form.category_id = e;\n            console.log(this.form.category_id);\n        },\n        getName(e) {\n            console.log(e);\n            this.ajaxData.name = e;\n            this.form.name = e;\n        },\n        getDes(e) {\n            console.log(e);\n            this.ajaxData.des = e;\n            this.form.des = e;\n        },\n        getSearchType(e) {\n\n        },\n        getSearchResult(e, pageNum = this.query.pageIndex) {\n            this.isLoading = true;\n            var list = ['category_id', 'name', 'des'];\n            var that = this;\n            this.query.pageIndex = 1;\n            console.log(this.searchType);\n            console.log(this.search_key_word);\n            console.log(this.categoryList);\n            console.log(this.categoryIdMap[this.search_key_word]);\n            if (this.search_key_word) {\n                this.showType = 'searching';\n                console.log(this.categoryIdMap[this.search_key_word]);\n                if (this.searchType === '0' && this.categoryIdMap[this.search_key_word] === undefined) {\n                    this.$message.error('请输入完整的分类名称');\n                    this.query.pageIndex = 1;\n                    this.getTableData();\n                    this.isLoading = false;\n                } else {\n                    var categoryTemp = undefined;\n                    if (this.searchType === '0') {\n                        console.log(this.categoryIdMap);\n                        categoryTemp = this.categoryIdMap[this.search_key_word];\n                    }\n                    this.api.searchSpecificCategoryCons({\n                        attrName: list[this.searchType] || 'name',\n                        attrValue: categoryTemp || this.search_key_word,\n                        pageNum: pageNum,\n                        pageSize: that.query.pageSize\n                    }).then(res => {\n                        res.data.categorycons.forEach(c => {\n                            c['category_name'] = this.categoryList[c.category_id - 1].name;\n                        });\n                        this.tableData = res.data.categorycons;\n                        this.isLoading = false;\n                        this.pageTotal = res.data.total;\n                    });\n                }\n\n            } else {\n                this.showType = 'normal';\n                this.$message.error('请输入搜索内容');\n                this.query.pageIndex = 1;\n                this.getTableData();\n                this.isLoading = false;\n            }\n            console.log(this.showType);\n\n        },\n        saveEdit() {\n            if (this.handleTitle === '添加常量') {\n                this.api.addCategoryCons(this.ajaxData).then(res => {\n                    console.log(res);\n                    this.getTableData();\n                    this.$message.success('添加常量成功');\n                }).catch(err => {\n                    this.$message.error('添加失败');\n                });\n            } else {\n                this.api.updateCategoryCons(this.ajaxData).then(res => {\n                    console.log(res);\n                    this.getTableData();\n                    this.$message.success('更新常量成功');\n                }).catch(err => {\n                    this.$message.error('更新失败');\n                });\n            }\n            this.editVisible = false;\n            console.log(this.ajaxData);\n        },\n        //数组去重\n        uniArr(arr) {\n            var obj = {};\n            var new_arr = arr.reduce(function(prev, element) {\n                if (!prev.find(el => el.category_con_id == element.category_con_id)) {\n                    prev.push(element);\n                }\n                return prev;\n            }, []);\n            return new_arr;\n        }\n    },\n    created() {\n        this.getTableData();\n    }\n};\n",{"version":3,"sources":["ConstantList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgHA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ConstantList.vue","sourceRoot":"src/components/page","sourcesContent":["<template>\n    <div>\n        <div class=\"crumbs\">\n            <el-breadcrumb>\n                <el-breadcrumb-item>\n                    <i class=\"el-icon-files\"></i> 常量列表\n                </el-breadcrumb-item>\n            </el-breadcrumb>\n        </div>\n        <div class=\"container\">\n            <div class=\"handle-box\">\n                <el-button\n                        type=\"primary\"\n                        icon=\"el-icon-lx-delete\"\n                        class=\"handle-del mr10\"\n                        @click=\"handleAdd\"\n                >\n                    添加常量\n                </el-button>\n                <el-button\n                        type=\"danger\"\n                        icon=\"el-icon-delete\"\n                        class=\"handle-del mr10\"\n                        @click=\"handleDeleteAllSelection\"\n                >\n                    删除选中项\n                </el-button>\n                <el-input placeholder=\"请输入内容\" v-model=\"search_key_word\" class=\"input-with-select\" clearable>\n                    <el-select style=\"width: 110px;\" v-model=\"searchType\" slot=\"prepend\"\n                               placeholder=\"常量名称\" @change=\"getSearchType\">\n                        <el-option label=\"分类名称\" value=\"0\"></el-option>\n                        <el-option label=\"常量名称\" value=\"1\"></el-option>\n                        <el-option label=\"常量描述\" value=\"2\"></el-option>\n                    </el-select>\n                    <el-button slot=\"append\" icon=\"el-icon-search\" @click=\"getSearchResult\"></el-button>\n                </el-input>\n            </div>\n            <div>\n                <el-table\n                        :data=\"tableData\"\n                        v-loading=\"isLoading\"\n                        border\n                        class=\"table\"\n                        ref=\"multipleTable\"\n                        @select=\"handleSelection\"\n                        @select-all=\"handleSelection\"\n                >\n                    <el-table-column type=\"selection\" width=\"60\" align=\"center\"></el-table-column>\n                    <el-table-column prop=\"category_name\" label=\"分类名称\" width=\"120\" align=\"center\"></el-table-column>\n                    <el-table-column prop=\"name\" label=\"常量名称\" width=\"120\" align=\"center\"></el-table-column>\n                    <el-table-column prop=\"des\" label=\"常量描述\" align=\"left\"></el-table-column>\n                    <el-table-column label=\"操作\" width=\"120\" align=\"center\">\n                        <template slot-scope=\"scope\">\n                            <el-button\n                                    type=\"text\"\n                                    icon=\"el-icon-edit\"\n                                    @click=\"handleEdit(scope.$index, scope.row)\"\n                            >编辑\n                            </el-button>\n                            <el-button\n                                    type=\"text\"\n                                    icon=\"el-icon-delete\"\n                                    class=\"red\"\n                                    @click=\"handleDelete(scope.$index, scope.row)\"\n                            >删除\n                            </el-button>\n                        </template>\n                    </el-table-column>\n                </el-table>\n                <div class=\"pagination\">\n                    <el-pagination\n                            background\n                            layout=\"total, prev, pager, next\"\n                            :current-page=\"query.pageIndex\"\n                            :page-size=\"query.pageSize\"\n                            :total=\"pageTotal\"\n                            @current-change=\"handlePageChange\"\n                    ></el-pagination>\n                </div>\n            </div>\n            <el-dialog width=\"40%\" :title=\"handleTitle\" :visible.sync=\"editVisible\" @close=\"handleDialogClose\">\n                <el-form ref=\"form\" :model=\"form\" label-width=\"70px\">\n                    <el-form-item label=\"分类名称\">\n                        <!--                        <el-input v-model=\"form.category_id\" @change=\"getCategory_id\"></el-input>-->\n                        <el-select v-model=\"form.category_id\" filterable placeholder=\"请选择\" @change=\"getCategory_id\">\n                            <el-option\n                                    v-for=\"item in categoryList\"\n                                    :key=\"item.id\"\n                                    :label=\"item.name\"\n                                    :value=\"item.id\"\n                            >\n                            </el-option>\n                        </el-select>\n                    </el-form-item>\n                    <el-form-item label=\"常量名称\">\n                        <el-input v-model=\"form.name\" @change=\"getName\"></el-input>\n                    </el-form-item>\n                    <el-form-item label=\"常量描述\">\n                        <el-input v-model=\"form.des\" @change=\"getDes\"></el-input>\n                    </el-form-item>\n                </el-form>\n                <div class=\"el-dialog__footer\">\n                    <span class=\"dialog-footer\">\n                    <el-button @click=\"editVisible = false\">取 消</el-button>\n                    <el-button type=\"primary\" @click=\"saveEdit\">确 定</el-button>\n                </span>\n                </div>\n            </el-dialog>\n        </div>\n    </div>\n</template>\n<script>\n    import api from '../../utils/api';\n\n    export default {\n        name: 'ConstantList',\n        data() {\n            return {\n                query: {\n                    address: '',\n                    name: '',\n                    pageIndex: 1,\n                    pageSize: 10\n                },\n                tableData: [],\n                pageTotal: 10,\n                isLoading: false,\n                categoryList: [],\n                categoryIdMap: {},\n                handleTitle: '',\n                editVisible: false,\n                form: {},\n                ajaxData: {\n                    id: 0,\n                    category_id: 0,\n                    name: '',\n                    des: ''\n                },\n                searchType: '',\n                search_key_word: '',\n                showType: 'normalData'\n            };\n        },\n        methods: {\n            getTableData() {\n                this.isLoading = true;\n                var that = this;\n                api.getCategoryCons({\n                    pageNum: that.query.pageIndex,\n                    pageSize: that.query.pageSize\n                }).then(res0 => {\n                    console.log(res0);\n                    api.getCategorys().then(res1 => {\n                        console.log(res1);\n                        this.categoryList = res1.data;\n                        res1.data.forEach(e => {\n                            this.categoryIdMap[e.name] = e.id;\n                        });\n                        res0.data.categorycons.forEach(c => {\n                            c['category_name'] = this.categoryList[c.category_id - 1].name;\n                        });\n                        this.tableData = res0.data.categorycons;\n                        this.isLoading = false;\n                        this.pageTotal = res0.data.total;\n                    }).catch(err => {\n                        console.log(err);\n                    });\n                }).catch(err => {\n                    console.log(err);\n                });\n            },\n            handleAdd() {\n                this.handleTitle = '添加常量';\n                this.editVisible = true;\n                this.form = {};\n            },\n            handleDeleteAllSelection() {\n\n            },\n            handleSelection(e) {\n                console.log(e);\n                this.$confirm(`确定要删除${e.length}行吗`, '提示', {\n                    type: 'warning'\n                }).catch(err => {\n                    console.log(err);\n                });\n            },\n            handlePageChange(val, e) {\n                this.$set(this.query, 'pageIndex', val);\n                if (this.showType === 'normalData') {\n                    this.getTableData();\n                } else {\n                    this.getSearchResult(e, val);\n                }\n\n            },\n            handleEdit(index, row) {\n                this.handleTitle = '编辑常量';\n                this.form = row;\n                this.ajaxData.id = row.id;\n                this.ajaxData.category_id = this.form.category_id;\n                this.ajaxData.name = this.form.name;\n                this.ajaxData.des = this.form.des;\n                this.editVisible = true;\n            },\n            handleDelete(index, row) {\n                this.$confirm('确定要删除吗', '提示', {\n                    type: 'warning'\n                }).then(() => {\n                    this.isLoading = true;\n                    this.api.deleteCategoryCons({\n                        id: row.id\n                    }).then(res => {\n                        this.isLoading = false;\n                        this.$message.success(`删除成功`);\n                        this.getTableData();\n                    });\n                });\n            },\n            handleDialogClose(e) {\n                // this.getTableData();\n            },\n            getCategory_id(e) {\n                this.ajaxData.category_id = e;\n                this.form.category_id = e;\n                console.log(this.form.category_id);\n            },\n            getName(e) {\n                console.log(e);\n                this.ajaxData.name = e;\n                this.form.name = e;\n            },\n            getDes(e) {\n                console.log(e);\n                this.ajaxData.des = e;\n                this.form.des = e;\n            },\n            getSearchType(e) {\n\n            },\n            getSearchResult(e, pageNum = this.query.pageIndex) {\n                this.isLoading = true;\n                var list = ['category_id', 'name', 'des'];\n                var that = this;\n                this.query.pageIndex = 1;\n                console.log(this.searchType);\n                console.log(this.search_key_word);\n                console.log(this.categoryList);\n                console.log(this.categoryIdMap[this.search_key_word]);\n                if (this.search_key_word) {\n                    this.showType = 'searching';\n                    console.log(this.categoryIdMap[this.search_key_word]);\n                    if (this.searchType === '0' && this.categoryIdMap[this.search_key_word] === undefined) {\n                        this.$message.error('请输入完整的分类名称');\n                        this.query.pageIndex = 1;\n                        this.getTableData();\n                        this.isLoading = false;\n                    } else {\n                        var categoryTemp = undefined;\n                        if (this.searchType === '0') {\n                            console.log(this.categoryIdMap);\n                            categoryTemp = this.categoryIdMap[this.search_key_word];\n                        }\n                        this.api.searchSpecificCategoryCons({\n                            attrName: list[this.searchType] || 'name',\n                            attrValue: categoryTemp || this.search_key_word,\n                            pageNum: pageNum,\n                            pageSize: that.query.pageSize\n                        }).then(res => {\n                            res.data.categorycons.forEach(c => {\n                                c['category_name'] = this.categoryList[c.category_id - 1].name;\n                            });\n                            this.tableData = res.data.categorycons;\n                            this.isLoading = false;\n                            this.pageTotal = res.data.total;\n                        });\n                    }\n\n                } else {\n                    this.showType = 'normal';\n                    this.$message.error('请输入搜索内容');\n                    this.query.pageIndex = 1;\n                    this.getTableData();\n                    this.isLoading = false;\n                }\n                console.log(this.showType);\n\n            },\n            saveEdit() {\n                if (this.handleTitle === '添加常量') {\n                    this.api.addCategoryCons(this.ajaxData).then(res => {\n                        console.log(res);\n                        this.getTableData();\n                        this.$message.success('添加常量成功');\n                    }).catch(err => {\n                        this.$message.error('添加失败');\n                    });\n                } else {\n                    this.api.updateCategoryCons(this.ajaxData).then(res => {\n                        console.log(res);\n                        this.getTableData();\n                        this.$message.success('更新常量成功');\n                    }).catch(err => {\n                        this.$message.error('更新失败');\n                    });\n                }\n                this.editVisible = false;\n                console.log(this.ajaxData);\n            },\n            //数组去重\n            uniArr(arr) {\n                var obj = {};\n                var new_arr = arr.reduce(function(prev, element) {\n                    if (!prev.find(el => el.category_con_id == element.category_con_id)) {\n                        prev.push(element);\n                    }\n                    return prev;\n                }, []);\n                return new_arr;\n            }\n        },\n        created() {\n            this.getTableData();\n        }\n    };\n</script>\n<style scoped>\n    .handle-box {\n        margin-bottom: 20px;\n        display: flex;\n    }\n\n    .dialog-footer {\n        right: 30px;\n    }\n\n    .input-with-select {\n        margin-left: 30px;\n    }\n</style>"]}]}